(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{6592:function(e,t,s){Promise.resolve().then(s.bind(s,4576))},4576:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return et}});var a=s(7437),r=s(2265),i=s(6463),l=s(5273),n=s(495),o=s(3274),d=s(2468),c=s(7390),m=s(1240),x=s(6273),h=s(4392),p=s(2813),u=s(837),g=s(3146),f=s(3102),j=s(7135),v=s(8604),y=s(4697),N=s(6717),b=s(6881),w=s(311);let _=["#health","#adoption","#lost","#training","#food","#toys","#grooming","#vet","#behavior"];function k(e){let{open:t,onOpenChange:s,user:i}=e,[l,d]=(0,r.useState)(""),[c,m]=(0,r.useState)(null),[x,h]=(0,r.useState)(null),[p,k]=(0,r.useState)([]),[C,S]=(0,r.useState)(""),[P,Z]=(0,r.useState)(!1),{toast:z}=(0,w.pm)(),q=e=>{e&&!p.includes(e)&&p.length<5&&(k([...p,e]),S(""))},D=e=>{k(p.filter(t=>t!==e))},O=async e=>{if(e.preventDefault(),!l.trim()){z({title:"Content required",description:"Please write something to share.",variant:"destructive"});return}let{data:t,error:a}=await b.O.from("profiles").select("id").eq("id",i.id).single();if(a||!t){var r;let{error:e}=await b.O.from("profiles").insert({id:i.id,email:i.email||"",full_name:(null===(r=i.user_metadata)||void 0===r?void 0:r.full_name)||"Anonymous User",phone:"",district:"",city:"",upazila:"",exact_address:"",is_verified:!1,is_admin:!1});if(e){z({title:"Error creating profile",description:"Please try again or contact support.",variant:"destructive"});return}}Z(!0);try{let e=null;if(c){let t=c.name.split(".").pop(),s="".concat(i.id,"-").concat(Date.now(),".").concat(t),{error:a}=await b.O.storage.from("post-images").upload(s,c);if(a)throw a;let{data:{publicUrl:r}}=b.O.storage.from("post-images").getPublicUrl(s);e=r}let{error:t}=await b.O.from("community_posts").insert({user_id:i.id,content:l.trim(),image_url:e,tags:p,is_approved:!0});if(t)throw t;z({title:"Post published!",description:"Your post has been published and is now visible in the community feed."}),d(""),m(null),h(null),k([]),S(""),s(!1)}catch(e){z({title:"Error creating post",description:e.message,variant:"destructive"})}finally{Z(!1)}};return(0,a.jsx)(u.Vq,{open:t,onOpenChange:s,children:(0,a.jsxs)(u.cZ,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[(0,a.jsx)(u.fK,{children:(0,a.jsx)(u.$N,{className:"flex items-center space-x-2",children:(0,a.jsx)("span",{children:"Share with Community"})})}),(0,a.jsxs)("form",{onSubmit:O,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(j._,{htmlFor:"content",children:"What's on your mind?"}),(0,a.jsx)(g.g,{id:"content",placeholder:"Share your pet story, ask for advice, or help other pet lovers...",value:l,onChange:e=>d(e.target.value),rows:4,className:"resize-none"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[l.length,"/1000 characters"]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(j._,{children:"Add Photo (Optional)"}),x?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:x,alt:"Preview",className:"w-full h-48 object-cover rounded-lg"}),(0,a.jsx)(n.z,{type:"button",variant:"destructive",size:"sm",onClick:()=>{m(null),h(null)},className:"absolute top-2 right-2",children:(0,a.jsx)(y.Z,{className:"h-4 w-4"})})]}):(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center hover:border-orange-500 transition-colors",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){m(s);let e=new FileReader;e.onload=e=>{var t;h(null===(t=e.target)||void 0===t?void 0:t.result)},e.readAsDataURL(s)}},className:"hidden",id:"image-upload"}),(0,a.jsxs)("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[(0,a.jsx)(v.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Click to upload an image"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"PNG, JPG, GIF up to 10MB"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(j._,{children:"Tags (Optional)"}),p.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:p.map(e=>(0,a.jsxs)("span",{className:"inline-flex items-center space-x-1 bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200 px-3 py-1 rounded-full text-sm",children:[(0,a.jsx)(N.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:e}),(0,a.jsx)("button",{type:"button",onClick:()=>D(e),className:"hover:text-red-500",children:(0,a.jsx)(y.Z,{className:"h-3 w-3"})})]},e))}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Suggested tags:"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:_.filter(e=>!p.includes(e)).slice(0,6).map(e=>(0,a.jsx)(n.z,{type:"button",variant:"outline",size:"sm",onClick:()=>q(e),disabled:p.length>=5,className:"text-xs",children:e},e))})]}),p.length<5&&(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(f.I,{placeholder:"Add custom tag (without #)",value:C,onChange:e=>S(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),C.trim()&&q("#".concat(C.trim())))}}),(0,a.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>C.trim()&&q("#".concat(C.trim())),disabled:!C.trim(),children:"Add"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Maximum 5 tags. Tags help others find your post."})]}),(0,a.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4",children:(0,a.jsxs)("p",{className:"text-sm text-green-800 dark:text-green-200",children:[(0,a.jsx)("strong",{children:"Note:"})," Your post will be published immediately and visible to all users in the community feed."]})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:P,children:"Cancel"}),(0,a.jsxs)(n.z,{type:"submit",disabled:P||!l.trim(),className:"bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700",children:[P&&(0,a.jsx)(o.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Share Post"]})]})]})]})})}var C=s(9152),S=s(2421),P=s(8803),Z=s(7440);let z=C.fC;C.ZA;let q=C.B4,D=r.forwardRef((e,t)=>{let{className:s,children:r,...i}=e;return(0,a.jsxs)(C.xz,{ref:t,className:(0,Z.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...i,children:[r,(0,a.jsx)(C.JO,{asChild:!0,children:(0,a.jsx)(S.Z,{className:"h-4 w-4 opacity-50"})})]})});D.displayName=C.xz.displayName;let O=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(C.u_,{ref:t,className:(0,Z.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(P.Z,{className:"h-4 w-4"})})});O.displayName=C.u_.displayName;let E=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(C.$G,{ref:t,className:(0,Z.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(S.Z,{className:"h-4 w-4"})})});E.displayName=C.$G.displayName;let A=r.forwardRef((e,t)=>{let{className:s,children:r,position:i="popper",...l}=e;return(0,a.jsx)(C.h_,{children:(0,a.jsxs)(C.VY,{ref:t,className:(0,Z.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...l,children:[(0,a.jsx)(O,{}),(0,a.jsx)(C.l_,{className:(0,Z.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(E,{})]})})});A.displayName=C.VY.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(C.__,{ref:t,className:(0,Z.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=C.__.displayName;let F=r.forwardRef((e,t)=>{let{className:s,children:r,...i}=e;return(0,a.jsxs)(C.ck,{ref:t,className:(0,Z.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(C.wU,{children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(C.eT,{children:r})]})});F.displayName=C.ck.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(C.Z0,{ref:t,className:(0,Z.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=C.Z0.displayName;let R=["Dog","Cat","Bird","Rabbit","Fish","Hamster","Guinea Pig","Ferret","Other"],Y=["Puppy/Kitten (0-1 year)","1-2 years","2-5 years","5-8 years","8+ years"];function U(e){let{open:t,onOpenChange:s,user:i}=e,[l,d]=(0,r.useState)({petName:"",petType:"",age:"",breed:"",description:"",location:"",contactPhone:""}),[c,m]=(0,r.useState)([]),[x,h]=(0,r.useState)([]),[p,N]=(0,r.useState)(!1),{toast:_}=(0,w.pm)(),k=(e,t)=>{d(s=>({...s,[e]:t}))},C=e=>{m(c.filter((t,s)=>s!==e)),h(x.filter((t,s)=>s!==e))},S=e=>/^(?:\+88|88)?(01[3-9]\d{8})$/.test(e),P=async e=>{e.preventDefault();try{if(N(!0),!l.petName.trim()||!l.petType||!l.age||!l.breed.trim()||!l.description.trim()||!l.location.trim()||!l.contactPhone.trim()){_({title:"All fields required",description:"Please fill in all the fields including phone number.",variant:"destructive"}),N(!1);return}if(!S(l.contactPhone)){_({title:"Invalid phone number",description:"Please enter a valid Bangladeshi phone number (e.g., 01712345678 or +8801712345678).",variant:"destructive"}),N(!1);return}let{data:e,error:a}=await b.O.from("profiles").select("id, phone").eq("id",i.id).single();if(a||!e){var t;let{error:e}=await b.O.from("profiles").insert({id:i.id,email:i.email||"",full_name:(null===(t=i.user_metadata)||void 0===t?void 0:t.full_name)||"Anonymous User",phone:l.contactPhone,district:"",city:"",upazila:"",exact_address:"",is_verified:!1,is_admin:!1});if(e){_({title:"Error creating profile",description:"Please try again or contact support.",variant:"destructive"}),N(!1);return}}let r=[];for(let e of c){let t=e.name.split(".").pop(),s="".concat(Math.random().toString(36).substring(2,15),".").concat(t),a="adoption_listings/".concat(i.id,"/").concat(Date.now(),"-").concat(s),{error:l}=await b.O.storage.from("petlink").upload(a,e);if(l)throw l;let{data:{publicUrl:n}}=b.O.storage.from("petlink").getPublicUrl(a);r.push(n)}if(e&&e.phone!==l.contactPhone)try{let{error:e}=await b.O.from("profiles").update({phone:l.contactPhone}).eq("id",i.id);e&&console.error("Error updating phone number:",e)}catch(e){console.error("Error updating phone number:",e)}let{data:n,error:o}=await b.O.from("adoption_listings").insert([{user_id:i.id,pet_name:l.petName,pet_type:l.petType,age:l.age,breed:l.breed,description:l.description,location:l.location,contact_phone:l.contactPhone,image_urls:x,is_approved:!0,is_adopted:!1}]).select().single();if(o)throw o;_({title:"Listing created!",description:"Your pet listing has been created successfully."}),d({petName:"",petType:"",age:"",breed:"",description:"",location:"",contactPhone:""}),m([]),h([]),s(!1)}catch(e){console.error("Error creating listing:",e),_({title:"Error creating listing",description:e.message||"An error occurred while creating your listing.",variant:"destructive"})}finally{N(!1)}};return(0,a.jsx)(u.Vq,{open:t,onOpenChange:s,children:(0,a.jsxs)(u.cZ,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[(0,a.jsx)(u.fK,{children:(0,a.jsx)(u.$N,{children:"List Pet for Adoption"})}),(0,a.jsxs)("form",{onSubmit:P,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(j._,{htmlFor:"pet-name",children:"Pet Name *"}),(0,a.jsx)(f.I,{id:"pet-name",placeholder:"Buddy, Luna, Charlie...",value:l.petName,onChange:e=>k("petName",e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(j._,{htmlFor:"pet-type",children:"Pet Type *"}),(0,a.jsxs)(z,{value:l.petType,onValueChange:e=>k("petType",e),children:[(0,a.jsx)(D,{children:(0,a.jsx)(q,{placeholder:"Select pet type"})}),(0,a.jsx)(A,{children:R.map(e=>(0,a.jsx)(F,{value:e,children:e},e))})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(j._,{htmlFor:"pet-age",children:"Age *"}),(0,a.jsxs)(z,{value:l.age,onValueChange:e=>k("age",e),children:[(0,a.jsx)(D,{children:(0,a.jsx)(q,{placeholder:"Select age range"})}),(0,a.jsx)(A,{children:Y.map(e=>(0,a.jsx)(F,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(j._,{htmlFor:"breed",children:"Breed *"}),(0,a.jsx)(f.I,{id:"breed",placeholder:"Golden Retriever, Persian, Mixed...",value:l.breed,onChange:e=>k("breed",e.target.value)})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(j._,{htmlFor:"location",children:"Location *"}),(0,a.jsx)(f.I,{id:"location",placeholder:"e.g., Dhaka, Bangladesh",value:l.location,onChange:e=>k("location",e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(j._,{htmlFor:"contactPhone",children:"Contact Phone *"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none",children:(0,a.jsx)("span",{className:"text-gray-500",children:"+880"})}),(0,a.jsx)(f.I,{id:"contactPhone",type:"tel",placeholder:"1712345678",value:l.contactPhone,onChange:e=>k("contactPhone",e.target.value.replace(/\D/g,"")),className:"pl-14",required:!0})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Enter your 11-digit Bangladeshi mobile number"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(j._,{htmlFor:"description",children:"Description *"}),(0,a.jsx)(g.g,{id:"description",placeholder:"Tell potential adopters about this pet's personality, health, special needs, etc.",value:l.description,onChange:e=>k("description",e.target.value),rows:4}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[l.description.length,"/1000 characters"]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(j._,{children:"Pet Photos (Up to 5)"}),x.length>0&&(0,a.jsx)("div",{className:"grid grid-cols-3 gap-4",children:x.map((e,t)=>(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("img",{src:e,alt:"Pet photo ".concat(t+1),className:"w-full h-24 object-cover rounded-lg"}),(0,a.jsx)(n.z,{type:"button",variant:"destructive",size:"sm",onClick:()=>C(t),className:"absolute -top-2 -right-2 h-6 w-6 p-0",children:(0,a.jsx)(y.Z,{className:"h-4 w-4"})})]},t))}),c.length<5&&(0,a.jsxs)("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center hover:border-teal-500 transition-colors",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{let t=Array.from(e.target.files||[]);if(c.length+t.length>5){_({title:"Too many images",description:"You can upload maximum 5 images.",variant:"destructive"});return}m([...c,...t]);let s=[...x];t.forEach(e=>{let t=new FileReader;t.onload=e=>{var t;s.push(null===(t=e.target)||void 0===t?void 0:t.result),h([...s])},t.readAsDataURL(e)})},className:"hidden",id:"images-upload"}),(0,a.jsxs)("label",{htmlFor:"images-upload",className:"cursor-pointer",children:[(0,a.jsx)(v.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Click to upload pet photos"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"PNG, JPG, GIF up to 10MB each"})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Clear, well-lit photos help your pet get adopted faster!"})]}),(0,a.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[(0,a.jsx)("strong",{children:"Note:"})," Your listing will be reviewed by our moderators before appearing in the adoption feed. This ensures the safety and wellbeing of all pets on our platform."]})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:p,children:"Cancel"}),(0,a.jsxs)(n.z,{type:"submit",disabled:p,className:"bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700",children:[p&&(0,a.jsx)(o.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit for Review"]})]})]})]})})}var I=s(6013),T=s(1647),B=s(7583),L=s(933),V=s(4042),G=s(560),M=s(2022),Q=s(5781);function J(e){let{postId:t,userId:s,onCommentAdded:i}=e,[l,d]=(0,r.useState)([]),[m,x]=(0,r.useState)(!0),[h,p]=(0,r.useState)(""),[u,g]=(0,r.useState)(null),[j,v]=(0,r.useState)(new Set),[y,N]=(0,r.useState)(new Set),{toast:_}=(0,w.pm)();(0,r.useEffect)(()=>{k()},[t]);let k=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{x(!0);let{data:s,error:a}=await b.O.from("post_comments").select("\n          id,\n          user_id,\n          content,\n          created_at,\n          parent_id,\n          profiles (\n            full_name,\n            is_verified\n          )\n        ").eq("post_id",t).is("parent_id",e).order("created_at",{ascending:!1});if(a)throw a;e?d(t=>{let a=t=>t.map(t=>t.id===e?{...t,replies:s.map(e=>({...e,profiles:Array.isArray(e.profiles)?e.profiles[0]:e.profiles,level:(t.level||0)+1}))}:t.replies?{...t,replies:a(t.replies)}:t);return a(t)}):d(s.map(e=>({...e,profiles:Array.isArray(e.profiles)?e.profiles[0]:e.profiles,level:0})))}catch(e){_({title:"Error loading comments",description:e.message,variant:"destructive"})}finally{x(!1),e&&N(t=>{let s=new Set(t);return s.delete(e),s})}},C=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e.preventDefault(),s&&h.trim())try{let{error:e}=await b.O.from("post_comments").insert([{user_id:s,post_id:t,content:h.trim(),parent_id:a}]);if(e)throw e;p(""),g(null),await k(a),i(),_({title:"Comment added",description:"Your comment has been posted successfully."})}catch(e){_({title:"Error adding comment",description:e.message,variant:"destructive"})}},Z=async(e,t)=>{if(j.has(e)){let t=new Set(j);t.delete(e),v(t)}else v(t=>new Set(t).add(e)),l.some(t=>{var s;return null===(s=t.replies)||void 0===s?void 0:s.some(t=>t.id===e)})||(N(t=>new Set(t).add(e)),await k(e))},z=e=>{var t,s,r,i,l,d;let m=e.replies&&e.replies.length>0,x=j.has(e.id),v=y.has(e.id),N=e.level?4*e.level:0;return(0,a.jsxs)("div",{className:"mt-4 ".concat(N>0?"ml-".concat(N," pl-4 border-l-2 border-gray-200 dark:border-gray-700"):""),children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(T.qE,{className:"h-8 w-8 flex-shrink-0",children:(0,a.jsx)(T.Q5,{className:"bg-gradient-to-r from-orange-500 to-teal-500 text-white text-xs",children:(null===(s=e.profiles)||void 0===s?void 0:null===(t=s.full_name)||void 0===t?void 0:t.split(" ").map(e=>e[0]).join("").toUpperCase())||"U"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg p-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"font-medium text-sm",children:(null===(r=e.profiles)||void 0===r?void 0:r.full_name)||"Anonymous"}),(null===(i=e.profiles)||void 0===i?void 0:i.is_verified)&&(0,a.jsx)("span",{className:"text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 px-1.5 py-0.5 rounded-full",children:"✓"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:(0,Q.Q)(new Date(e.created_at),{addSuffix:!0})})]}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-800 dark:text-gray-200",children:e.content})]}),(0,a.jsxs)("div",{className:"mt-1 flex items-center space-x-4 text-xs text-gray-500",children:[(0,a.jsxs)("button",{onClick:()=>g(u===e.id?null:e.id),className:"hover:text-blue-500 flex items-center space-x-1",children:[(0,a.jsx)(c.Z,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{children:"Reply"})]}),m&&(0,a.jsx)("button",{onClick:()=>Z(e.id,!!m),className:"hover:text-blue-500 flex items-center space-x-1",disabled:v,children:v?(0,a.jsx)(o.Z,{className:"h-3.5 w-3.5 animate-spin"}):x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(P.Z,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{children:"Hide replies"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.Z,{className:"h-3.5 w-3.5"}),(0,a.jsxs)("span",{children:["View replies (",null===(l=e.replies)||void 0===l?void 0:l.length,")"]})]})})]}),u===e.id&&(0,a.jsxs)("form",{onSubmit:t=>C(t,e.id),className:"mt-3 flex items-start space-x-2",children:[(0,a.jsx)(f.I,{placeholder:"Reply to ".concat((null===(d=e.profiles)||void 0===d?void 0:d.full_name)||"this comment","..."),value:h,onChange:e=>p(e.target.value),className:"flex-1 text-sm",autoFocus:!0}),(0,a.jsx)(n.z,{type:"submit",size:"sm",disabled:!h.trim(),className:"bg-gradient-to-r from-orange-500 to-teal-500 hover:from-orange-600 hover:to-teal-600",children:"Reply"})]})]})]}),x&&m&&e.replies&&(0,a.jsx)("div",{className:"mt-2",children:e.replies.map(e=>z(e))})]},e.id)};return(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("form",{onSubmit:e=>C(e,null),className:"mb-6",children:(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(T.qE,{className:"h-8 w-8 flex-shrink-0",children:(0,a.jsx)(T.Q5,{className:"bg-gradient-to-r from-orange-500 to-teal-500 text-white text-xs",children:s?"U":(0,a.jsx)(M.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(f.I,{placeholder:"Write a comment...",value:h,onChange:e=>p(e.target.value),disabled:!s}),(0,a.jsx)("div",{className:"mt-2 flex justify-end",children:(0,a.jsx)(n.z,{type:"submit",size:"sm",disabled:!s||!h.trim(),className:"bg-gradient-to-r from-orange-500 to-teal-500 hover:from-orange-600 hover:to-teal-600",children:"Comment"})})]})]})}),(0,a.jsx)("div",{className:"space-y-4",children:m?(0,a.jsx)("div",{className:"flex justify-center py-4",children:(0,a.jsx)(o.Z,{className:"h-6 w-6 animate-spin text-gray-500"})}):l.length>0?l.map(e=>z(e)):(0,a.jsx)("div",{className:"text-center py-6 text-gray-500",children:"No comments yet. Be the first to comment!"})})]})}function $(e){let{user:t}=e,[s,i]=(0,r.useState)([]),[l,o]=(0,r.useState)(!0),[d,c]=(0,r.useState)({}),[m,x]=(0,r.useState)(new Set),[h,p]=(0,r.useState)(new Set),[u,g]=(0,r.useState)({}),{toast:f}=(0,w.pm)();(0,r.useEffect)(()=>{j()},[t]);let j=async()=>{try{let e=b.O.from("community_posts").select("\n          id,\n          user_id,\n          content,\n          image_url,\n          tags,\n          likes_count,\n          comments_count,\n          created_at,\n          profiles (\n            full_name,\n            is_verified\n          )\n        ").eq("is_approved",!0).order("created_at",{ascending:!1}).limit(20),{data:s,error:a}=await e;if(a)throw a;if(t&&s){let e=s.map(e=>e.id),{data:a}=await b.O.from("post_likes").select("post_id").eq("user_id",t.id).in("post_id",e),r=new Set(null==a?void 0:a.map(e=>e.post_id)),l=s.map(e=>({...e,profiles:Array.isArray(e.profiles)?e.profiles[0]:e.profiles||{full_name:"Anonymous User",is_verified:!1},user_liked:r.has(e.id)}));i(l)}else{let e=(s||[]).map(e=>({...e,profiles:Array.isArray(e.profiles)?e.profiles[0]:e.profiles||{full_name:"Anonymous User",is_verified:!1}}));i(e)}}catch(e){f({title:"Error loading posts",description:e.message,variant:"destructive"})}finally{o(!1)}},v=async e=>{if(!t){f({title:"Sign in to engage",description:"Create an account or sign in to like and comment on posts.",variant:"default",action:(0,a.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>{window.dispatchEvent(new Event("openAuthModal"))},children:"Sign In"})});return}try{let a=s.find(t=>t.id===e);if(!a)return;a.user_liked?(await b.O.from("post_likes").delete().eq("user_id",t.id).eq("post_id",e),i(s.map(t=>t.id===e?{...t,user_liked:!1,likes_count:t.likes_count-1}:t))):(await b.O.from("post_likes").insert({user_id:t.id,post_id:e}),i(s.map(t=>t.id===e?{...t,user_liked:!0,likes_count:t.likes_count+1}:t)))}catch(e){f({title:"Error updating like",description:e.message,variant:"destructive"})}},y=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase();if(l)return(0,a.jsx)("div",{className:"space-y-6 max-w-4xl mx-auto py-8 px-4",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)(I.Zb,{className:"animate-pulse",children:[(0,a.jsx)(I.Ol,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-24"}),(0,a.jsx)("div",{className:"h-3 bg-gray-200 rounded w-16"})]})]})}),(0,a.jsx)(I.aY,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,a.jsx)("div",{className:"h-32 bg-gray-200 rounded-lg"})]})})]},t))});let _=()=>(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 mb-6",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[(0,a.jsxs)("div",{className:"mb-4 md:mb-0 md:mr-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Welcome to PetLinkBD Community! \uD83D\uDC3E"}),(0,a.jsx)("p",{className:"text-gray-700",children:t?"Connect with fellow pet lovers, share stories, and find your perfect pet companion.":"You're viewing in read-only mode. Join our community to engage with posts, like, and comment!"})]}),!t&&(0,a.jsx)(n.z,{variant:"default",size:"lg",className:"whitespace-nowrap",onClick:()=>window.dispatchEvent(new Event("openAuthModal")),children:"Sign Up / Sign In"})]})});return 0===s.length?(0,a.jsxs)("div",{className:"max-w-4xl mx-auto py-8 px-4",children:[(0,a.jsx)(_,{}),(0,a.jsx)(I.Zb,{children:(0,a.jsxs)(I.aY,{className:"py-12 text-center",children:[(0,a.jsx)(B.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No posts yet"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:t?"Be the first to share something with the community!":"Sign in to create the first post in our community."}),!t&&(0,a.jsx)(n.z,{variant:"outline",onClick:()=>window.dispatchEvent(new Event("openAuthModal")),children:"Sign In to Post"})]})})]}):(0,a.jsxs)("div",{className:"space-y-6 max-w-4xl mx-auto py-8 px-4",children:[(0,a.jsx)(_,{}),s.map(e=>(0,a.jsxs)(I.Zb,{className:"bg-white dark:bg-gray-800 hover:shadow-lg transition-shadow",children:[(0,a.jsx)(I.Ol,{className:"pb-3",children:(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(T.qE,{className:"h-10 w-10",children:(0,a.jsx)(T.Q5,{className:"bg-gradient-to-r from-orange-500 to-teal-500 text-white",children:y(e.profiles.full_name)})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:e.profiles.full_name}),e.profiles.is_verified&&(0,a.jsx)("span",{className:"text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 px-2 py-0.5 rounded-full font-medium",children:"✓ Verified"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-500",children:[(0,a.jsx)(L.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:(0,Q.Q)(new Date(e.created_at),{addSuffix:!0})})]})]})]})})}),(0,a.jsxs)(I.aY,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-900 dark:text-white whitespace-pre-wrap",children:e.content}),e.image_url&&(0,a.jsx)("div",{className:"rounded-lg overflow-hidden",children:(0,a.jsx)("img",{src:e.image_url,alt:"Post image",className:"w-full h-auto max-h-96 object-cover"})}),e.tags.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tags.map((e,t)=>(0,a.jsxs)("span",{className:"inline-flex items-center space-x-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded-full text-sm",children:[(0,a.jsx)(N.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:e})]},t))}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)(n.z,{variant:"ghost",size:"sm",onClick:()=>v(e.id),className:"flex items-center space-x-2 ".concat(e.user_liked?"text-red-500 hover:text-red-600":"text-gray-600 hover:text-red-500"),children:[(0,a.jsx)(V.Z,{className:"h-4 w-4 ".concat(e.user_liked?"fill-current":"")}),(0,a.jsx)("span",{children:e.likes_count})]}),(0,a.jsxs)(n.z,{variant:"ghost",size:"sm",onClick:()=>{if(h.has(e.id)){let t=new Set(h);t.delete(e.id),p(t)}else p(t=>new Set(t).add(e.id))},className:"flex items-center space-x-2 ".concat(h.has(e.id)?"text-blue-500":"text-gray-600 hover:text-blue-500"),children:[(0,a.jsx)(B.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:e.comments_count}),e.comments_count>0&&(0,a.jsx)(a.Fragment,{children:h.has(e.id)?(0,a.jsx)(P.Z,{className:"h-4 w-4"}):(0,a.jsx)(S.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)(n.z,{variant:"ghost",size:"sm",className:"flex items-center space-x-2 text-gray-600 hover:text-green-500",children:[(0,a.jsx)(G.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Share"})]})]}),h.has(e.id)&&(0,a.jsx)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsx)(J,{postId:e.id,userId:(null==t?void 0:t.id)||null,onCommentAdded:()=>{let t=(u[e.id]||0)+1;g(s=>({...s,[e.id]:t})),i(s=>s.map(s=>s.id===e.id?{...s,comments_count:t}:s))}})})]})]},e.id))]})}var K=s(4693),W=s(9321);function H(e){let{open:t,onOpenChange:s,listing:i,user:l,onSuccess:d}=e,[c,m]=(0,r.useState)(""),[x,h]=(0,r.useState)(!1),{toast:p}=(0,w.pm)(),f=async e=>{if(e.preventDefault(),!c.trim()){p({title:"Message required",description:"Please write a message to the pet owner.",variant:"destructive"});return}if(!l){p({title:"Authentication required",description:"Please sign in to send adoption request.",variant:"destructive"});return}h(!0);try{let{error:e}=await b.O.from("adoption_requests").insert({adopter_id:l.id,listing_id:i.id,message:c.trim(),status:"pending"});if(e){if("23505"===e.code)throw Error("You have already sent a request for this pet.");throw e}p({title:"Request sent!",description:"Your adoption request for ".concat(i.pet_name," has been sent to ").concat(i.profiles.full_name,". They will review and respond to your request.")}),m(""),d()}catch(e){p({title:"Error sending request",description:e.message,variant:"destructive"})}finally{h(!1)}};return(0,a.jsx)(u.Vq,{open:t,onOpenChange:s,children:(0,a.jsxs)(u.cZ,{className:"sm:max-w-[500px]",children:[(0,a.jsx)(u.fK,{children:(0,a.jsxs)(u.$N,{className:"flex items-center space-x-2",children:[(0,a.jsx)(V.Z,{className:"h-5 w-5 text-teal-500"}),(0,a.jsx)("span",{children:"Request Adoption"})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[(0,a.jsxs)("h3",{className:"font-medium text-gray-900 dark:text-white mb-2",children:["Pet: ",i.pet_name," (",i.pet_type,")"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300",children:[(0,a.jsx)(M.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["Owner: ",i.profiles.full_name]})]})]}),(0,a.jsxs)("form",{onSubmit:f,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(j._,{htmlFor:"message",children:"Your Message to the Owner *"}),(0,a.jsx)(g.g,{id:"message",placeholder:"Hi! I'm interested in adopting this pet. Tell the owner about yourself, your experience with pets, living situation, etc.",value:c,onChange:e=>m(e.target.value),rows:6,className:"resize-none"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[c.length,"/500 characters"]})]}),(0,a.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:(0,a.jsxs)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[(0,a.jsx)("strong",{children:"Important:"})," Your adoption request will be sent directly to the pet owner. They will review your message and contact you if they think you'd be a good match for their pet. Please be honest and detailed about your living situation and experience with pets."]})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)(n.z,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:x,children:"Cancel"}),(0,a.jsxs)(n.z,{type:"submit",disabled:x||!c.trim(),className:"bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700",children:[x&&(0,a.jsx)(o.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Send Request"]})]})]})]})]})})}function X(e){let{user:t}=e,[s,i]=(0,r.useState)([]),[l,o]=(0,r.useState)(!0),[d,c]=(0,r.useState)(null),[m,x]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),{toast:u}=(0,w.pm)();(0,r.useEffect)(()=>{f(),t&&g()},[t]);let g=async()=>{if(!t)return;let{data:e}=await b.O.from("profiles").select("*").eq("id",t.id).single();p(e)},f=async()=>{try{let{data:e,error:t}=await b.O.from("adoption_listings").select("\n          id,\n          user_id,\n          pet_name,\n          pet_type,\n          age,\n          breed,\n          description,\n          image_urls,\n          location,\n          created_at,\n          profiles (\n            full_name,\n            is_verified,\n            district,\n            city\n          )\n        ").eq("is_approved",!0).eq("is_adopted",!1).order("created_at",{ascending:!1});if(t)throw t;let s=(e||[]).map(e=>({...e,profiles:Array.isArray(e.profiles)?e.profiles[0]||null:e.profiles}));i(s||[])}catch(e){u({title:"Error loading listings",description:e.message,variant:"destructive"})}finally{o(!1)}},j=e=>{if(!t){u({title:"Please sign in",description:"You need to be signed in to request adoption.",variant:"destructive"});return}if(!(null==h?void 0:h.is_verified)){u({title:"Verification required",description:"You need to be a verified user to request adoption. Please complete your profile with NID verification.",variant:"destructive"});return}c(e),x(!0)},v=e=>e.split(" ").map(e=>e[0]).join("").toUpperCase(),y=e=>{let t=e.toLowerCase();return t.includes("dog")?"\uD83D\uDC15":t.includes("cat")?"\uD83D\uDC31":t.includes("bird")?"\uD83D\uDC26":t.includes("rabbit")?"\uD83D\uDC30":t.includes("fish")?"\uD83D\uDC1F":"\uD83D\uDC3E"};return l?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((e,t)=>(0,a.jsxs)(I.Zb,{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-48 bg-gray-200 rounded-t-lg"}),(0,a.jsxs)(I.Ol,{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-6 bg-gray-200 rounded w-3/4"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]}),(0,a.jsxs)(I.aY,{className:"space-y-3",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"}),(0,a.jsx)("div",{className:"h-10 bg-gray-200 rounded"})]})]},t))}):0===s.length?(0,a.jsx)(I.Zb,{children:(0,a.jsxs)(I.aY,{className:"py-12 text-center",children:[(0,a.jsx)(V.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No pets available for adoption"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Check back soon for new adoption opportunities!"})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(e=>(0,a.jsxs)(I.Zb,{className:"bg-white dark:bg-gray-800 hover:shadow-lg transition-shadow overflow-hidden",children:[(0,a.jsxs)("div",{className:"relative h-48",children:[e.image_urls&&e.image_urls.length>0?(0,a.jsx)("img",{src:e.image_urls[0],alt:e.pet_name,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-orange-100 to-teal-100 dark:from-orange-900/20 dark:to-teal-900/20 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-4xl",children:y(e.pet_type)})}),(0,a.jsx)("div",{className:"absolute top-3 left-3",children:(0,a.jsx)(K.C,{className:"bg-white/90 text-gray-900 shadow-sm",children:e.pet_type})})]}),(0,a.jsxs)(I.Ol,{className:"pb-3",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-lg text-gray-900 dark:text-white",children:e.pet_name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.breed," • ",e.age]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[(0,a.jsx)(L.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:(0,Q.Q)(new Date(e.created_at),{addSuffix:!0})})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1 text-sm text-gray-600 dark:text-gray-300",children:[(0,a.jsx)(W.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:e.location})]})]}),(0,a.jsxs)(I.aY,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300 line-clamp-3",children:e.description}),(0,a.jsx)("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(T.qE,{className:"h-6 w-6",children:(0,a.jsx)(T.Q5,{className:"bg-gradient-to-r from-orange-500 to-teal-500 text-white text-xs",children:v(e.profiles.full_name)})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-900 dark:text-white",children:e.profiles.full_name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.profiles.district,", ",e.profiles.city]})]}),e.profiles.is_verified&&(0,a.jsx)("span",{className:"text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 px-1.5 py-0.5 rounded-full font-medium",children:"✓"})]})}),(0,a.jsx)(n.z,{onClick:()=>j(e),className:"w-full bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 text-white",disabled:e.user_id===(null==t?void 0:t.id),children:e.user_id===(null==t?void 0:t.id)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M.Z,{className:"h-4 w-4 mr-2"}),"Your Listing"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(V.Z,{className:"h-4 w-4 mr-2"}),"Request Adoption"]})})]})]},e.id))}),d&&(0,a.jsx)(H,{open:m,onOpenChange:x,listing:d,user:t,onSuccess:()=>{x(!1),c(null)}})]})}let ee=(0,h.createClientComponentClient)();function et(){var e;let[t,s]=(0,r.useState)(null),[h,u]=(0,r.useState)(null),[g,f]=(0,r.useState)(!0),[j,v]=(0,r.useState)(!1),[y,N]=(0,r.useState)(!1),[b,_]=(0,r.useState)(!1),[C,S]=(0,r.useState)("community");(0,i.useRouter)();let{toast:P}=(0,w.pm)();return((0,r.useEffect)(()=>{(async()=>{try{let{data:{user:e},error:t}=await ee.auth.getUser();if(t)throw t;if(s(e),e){let{data:t,error:s}=await ee.from("profiles").select("*").eq("id",e.id).single();if(s)throw s;u(t)}}catch(e){console.error("Error fetching user data:",e),P({title:"Error",description:"Failed to load user data. Please try again.",variant:"destructive"})}finally{f(!1)}})();let{data:{subscription:e}}=ee.auth.onAuthStateChange(async(e,t)=>{var a;if(s(null!==(a=null==t?void 0:t.user)&&void 0!==a?a:null),null==t?void 0:t.user)try{let{data:e,error:s}=await ee.from("profiles").select("*").eq("id",t.user.id).single();if(s)throw s;u(e)}catch(e){console.error("Error updating profile on auth state change:",e)}else u(null);f(!1)});return()=>e.unsubscribe()},[P]),g)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"h-8 w-8 animate-spin text-orange-500"})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-teal-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900",children:[(0,a.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsxs)("div",{className:"text-center space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h1",{className:"text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white",children:t?(0,a.jsxs)(a.Fragment,{children:["Welcome back,"," ",(0,a.jsx)("span",{className:"bg-gradient-to-r from-orange-500 to-teal-500 bg-clip-text text-transparent",children:(null==h?void 0:null===(e=h.full_name)||void 0===e?void 0:e.split(" ")[0])||"Friend"}),"!"]}):(0,a.jsxs)(a.Fragment,{children:["Welcome to"," ",(0,a.jsx)("span",{className:"bg-gradient-to-r from-orange-500 to-teal-500 bg-clip-text text-transparent",children:"PetLinkBD"})]})}),(0,a.jsx)("p",{className:"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto",children:t?"Share your pet journey and discover amazing adoption opportunities":"Join our community to start your pet adoption journey"})]}),!t&&(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center",children:[(0,a.jsx)(n.z,{onClick:()=>v(!0),size:"lg",className:"bg-gradient-to-r from-orange-500 to-teal-500 hover:from-orange-600 hover:to-teal-600 text-white px-8 py-4 text-lg shadow-lg hover:shadow-xl transition-shadow",children:"Join Our Community"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 text-green-500"}),(0,a.jsx)("span",{children:"100% Free to Join"})]})]})]})}),(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)(l.mQ,{value:C,onValueChange:S,className:"w-full",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[(0,a.jsxs)(l.dr,{className:"grid w-full sm:w-auto grid-cols-2 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm shadow-lg",children:[(0,a.jsxs)(l.SP,{value:"community",className:"flex items-center gap-2 data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500 data-[state=active]:to-orange-600 data-[state=active]:text-white",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4"}),"Community Feed"]}),(0,a.jsxs)(l.SP,{value:"adoption",className:"flex items-center gap-2 data-[state=active]:bg-gradient-to-r data-[state=active]:from-teal-500 data-[state=active]:to-teal-600 data-[state=active]:text-white",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4"}),"Adoption Listings"]})]}),t&&(0,a.jsxs)("div",{className:"flex gap-2 w-full sm:w-auto",children:["community"===C&&(0,a.jsxs)(n.z,{onClick:()=>{if(!t){v(!0);return}N(!0)},className:"flex-1 sm:flex-none bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 shadow-lg hover:shadow-xl transition-shadow",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"New Post"]}),"adoption"===C&&(0,a.jsxs)(n.z,{onClick:()=>{if(!t){v(!0);return}_(!0)},className:"flex-1 sm:flex-none bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 shadow-lg hover:shadow-xl transition-shadow",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"List Pet"]})]})]}),(0,a.jsx)(l.nU,{value:"community",className:"space-y-6",children:(0,a.jsx)($,{user:t})}),(0,a.jsx)(l.nU,{value:"adoption",className:"space-y-6",children:(0,a.jsx)(X,{user:t})})]})})]}),(0,a.jsx)(p.Z,{open:j,onOpenChange:v}),t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k,{open:y,onOpenChange:N,user:t}),(0,a.jsx)(U,{open:b,onOpenChange:_,user:t})]})]})}},3146:function(e,t,s){"use strict";s.d(t,{g:function(){return l}});var a=s(7437),r=s(2265),i=s(7440);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...r})});l.displayName="Textarea"}},function(e){e.O(0,[794,545,202,996,513,306,927,971,23,744],function(){return e(e.s=6592)}),_N_E=e.O()}]);